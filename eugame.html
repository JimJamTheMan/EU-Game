<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EU Star Snake â€“ Mobile Version</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #003399;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }
    canvas {
      display: block;
      margin: auto;
      background: #003399;
      border: 4px solid #003399;
      touch-action: none;
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let gameState = "menu"; // 'menu', 'playing', 'gameover'

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const STAR_COLOR = "#FFCC00";
const BG_COLOR = "#003399";
const BASE_SPEED = 3;

let path = [];
let snakeLength = 1;
let spacing = Math.min(canvas.width, canvas.height) * 0.015;

let head = { x: canvas.width / 2, y: canvas.height / 2 };
let direction = { x: 1, y: 0 };

let star;

let noteIndex = 0;
const notes = [
  "E","E","F","G","G","F","E","D",
  "C","C","D","E","E","D","D",
  "E","E","F","G","G","F","E","D",
  "C","C","D","E","D","C","C",
  "D","D","E","C","D","E","F","E",
  "C","D","E","F","E","D","C","D","G",
  "E","E","F","G","G","F","E","D",
  "C","C","D","E","D","C","C"
];

const noteSounds = {
  C: new Audio("C.mp3"),
  D: new Audio("D.mp3"),
  E: new Audio("E.mp3"),
  F: new Audio("F.mp3"),
  G: new Audio("G.mp3")
};

function drawStar(cx, cy, spikes, outerRadius, innerRadius, color) {
  const step = Math.PI / spikes;
  let rot = -Math.PI / 2;
  ctx.beginPath();
  ctx.moveTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius);
  for (let i = 0; i < spikes; i++) {
    rot += step;
    ctx.lineTo(cx + Math.cos(rot) * innerRadius, cy + Math.sin(rot) * innerRadius);
    rot += step;
    ctx.lineTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius);
  }
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill();
}

function playNextNote() {
  const note = notes[noteIndex % notes.length];
  const audio = noteSounds[note];
  if (audio) {
    audio.currentTime = 0;
    audio.play();
  }
  noteIndex++;
}

function randomStar() {
  const marginX = canvas.width * 0.1;
  const marginY = canvas.height * 0.1;
  return {
    x: Math.random() * (canvas.width - marginX * 2) + marginX,
    y: Math.random() * (canvas.height - marginY * 2) + marginY
  };
}

function checkStarCollision() {
  const dx = head.x - star.x;
  const dy = head.y - star.y;
  return Math.hypot(dx, dy) < 20;
}

function wrapAround(position) {
  if (position.x < 0) position.x += canvas.width;
  if (position.x > canvas.width) position.x -= canvas.width;
  if (position.y < 0) position.y += canvas.height;
  if (position.y > canvas.height) position.y -= canvas.height;
}

function checkSelfCollision() {
  for (let i = Math.floor(spacing * 2); i < path.length; i++) {
    const p = path[i];
    const dx = head.x - p.x;
    const dy = head.y - p.y;
    if (Math.hypot(dx, dy) < spacing / 2) {
      return true;
    }
  }
  return false;
}

function resetGame() {
  snakeLength = 1;
  path = [];
  head = { x: canvas.width / 2, y: canvas.height / 2 };
  direction = { x: 1, y: 0 };
  star = randomStar();
  noteIndex = 0;
  speed = BASE_SPEED;
}

let speed = BASE_SPEED;

function update() {
  if (gameState !== "playing") return;
  head.x += direction.x * speed;
  head.y += direction.y * speed;
  wrapAround(head);

  path.unshift({ x: head.x, y: head.y });
  const maxPath = Math.floor(snakeLength * spacing);
  if (path.length > maxPath) path.length = maxPath;

  if (checkStarCollision()) {
    snakeLength++;
    star = randomStar();
    speed = BASE_SPEED + (snakeLength - 1) * 0.2;
  }

  if (checkSelfCollision()) {
    gameState = "menu";
  }
}

function draw() {
  ctx.fillStyle = BG_COLOR;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (gameState === "menu") {
    ctx.fillStyle = STAR_COLOR;
    ctx.font = "bold 32px Arial";
    ctx.textAlign = "center";
    ctx.fillText("EU Star Snake", canvas.width / 2, canvas.height / 2 - 20);
    ctx.font = "20px Arial";
    ctx.fillText("Tap to Start", canvas.width / 2, canvas.height / 2 + 20);
    return;
  }

  const starOuter = spacing;
  const starInner = starOuter * 0.45;

  for (let i = 0; i < path.length; i += Math.floor(spacing)) {
    const p = path[i];
    drawStar(p.x, p.y, 5, starOuter, starInner, STAR_COLOR);
  }

  drawStar(star.x, star.y, 5, starOuter * 1.2, starInner * 1.2, STAR_COLOR);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

canvas.addEventListener("click", e => {
  if (gameState === "menu") {
    resetGame();
    gameState = "playing";
    return;
  }
  const rect = canvas.getBoundingClientRect();
  const tx = e.clientX - rect.left;
  const ty = e.clientY - rect.top;
  const dx = tx - head.x;
  const dy = ty - head.y;
  const angle = Math.atan2(dy, dx);
  direction.x = Math.cos(angle);
  direction.y = Math.sin(angle);
  playNextNote();
});

canvas.addEventListener("touchstart", e => {
  if (gameState === "menu") {
    resetGame();
    gameState = "playing";
    return;
  }
  if (e.touches.length > 0) {
    const t = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    const tx = t.clientX - rect.left;
    const ty = t.clientY - rect.top;
    const dx = tx - head.x;
    const dy = ty - head.y;
    const angle = Math.atan2(dy, dx);
    direction.x = Math.cos(angle);
    direction.y = Math.sin(angle);
    playNextNote();
  }
}, { passive: false });

function resizeCanvas() {
  const prevWidth = canvas.width;
  const prevHeight = canvas.height;

  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const scaleX = canvas.width / prevWidth;
  const scaleY = canvas.height / prevHeight;

  head.x *= scaleX;
  head.y *= scaleY;
  path = path.map(p => ({ x: p.x * scaleX, y: p.y * scaleY }));

  spacing = Math.min(canvas.width, canvas.height) * 0.015;

  const marginX = canvas.width * 0.1;
  const marginY = canvas.height * 0.1;
  if (
    star.x < marginX ||
    star.x > canvas.width - marginX ||
    star.y < marginY ||
    star.y > canvas.height - marginY
  ) {
    star = randomStar();
  }
}

window.addEventListener("resize", resizeCanvas);

resetGame();
gameState = "menu";
resizeCanvas();
loop();
</script>
</body>
</html>

